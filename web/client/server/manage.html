<!DOCTYPE html>
<html>
<head>
  <title>test</title>
  <meta charset="utf-8">
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
  <link href="manage.css" rel="stylesheet" type="text/css" />
</head>
<body>
    <h1 align = "center">後臺管理系統</h1>

  <div class="container">

    <div class="row1">
        <div class="col-lg-3">
            <h3>標題</h3>
        </div>
        <div class="col-lg-1">
            <h3>來源</h3>
        </div>
        <div class="col-lg-2">
            <h3>類別</h3>
        </div>
        <div class="col-lg-3">
            <h3>TAG</h3>
        </div>
        <div class="col-lg-1">
            <h3>顯示</h3>
        </div>
        <div class="col-lg-1">
            <h3>編輯</h3>
        </div>
        <div class="col-lg-1">
            <h3>刪除</h3>
        </div>
    </div>

    <div class="row">
    </div>
</div>
    <script src="jquery-3.4.1.js"></script>
    <script>

  $(function () {/*API操作和顯示區*/
        var hash_local;
        var url = window.location.search;
        var hash = url.substr(1);
        if (hash != ""){
            localStorage.user= hash;
            hash_local = localStorage.user;
            alert(hash_local)
        }
        else {
            hash_local = localStorage.user;
            alert(hash_local)
        }


        $.ajax({
            type: 'post',
            url: ' https://djangotest1156.herokuapp.com/api/RSS/get_info_min/',
            dataType:'json',
            data: {
               'hash': hash_local ,
               'account':'etaac'
            },
            success: function (result) {
                console.log(result);
                  $.each(result, function(index,element) {
                      $('.row').append(

                          $('<div class="col-lg-3 title">').append(
                            $('<p>',
                            {text:element.title})
                            ),

                          $('<div class="col-lg-1 source">').append(
                            $('<p>',
                            {text:element.source})
                            ),

                          $('<div class="col-lg-2 category">').append(
                            $('<p>',
                            {text:element.category})
                            ),

                          $('<div class="col-lg-3 tag">').append(
                            $('<p>',
                            {text:element.tag})
                            ),

                          $('<div class="col-lg-1 display">').append(
                            $('<p>',
                            {text:element.display})
                            ),

                          $('<div class="col-lg-1 edit">').append(
                            $('<input type="button" onclick="Edit_Id(this)" value="編輯" style="margin:5px;width:50px;height:24px;">'),
                            $('<p>',{text: element.id })
                          ),


                          $('<div class="col-lg-1 delete">').append(
                            $('<input type="button" onclick="Delete_Id(this)" value="刪除" style="margin:5px;width:50px;height:24px;">'),
                            $('<p>',{text: element.id })
                          )


                        )

                  });
            },
            error: function () {
                alert("錯誤")
            }

        });
    });

    function Edit_Id(e) {
        let EdId = e.nextSibling;
        var EID = EdId.innerHTML;
        console.log(EID);
        window.location.href= "modify.html"+"?"+"id="+EID;
    }


    function Delete_Id(e) {
        let DeId = e.nextSibling;
        var DID = DeId.innerHTML;
        Delete_Data (DID);
    }


      function Delete_Data (DID) {
        console.log(DID);
        console.log('asd');
        $(function () {
          console.log(DID);
            $.ajax({
                type: 'delete',
                url: 'https://djangotest1156.herokuapp.com/api/RSS/delete/',
                dataType:'json',
                data: {
                    'id': DID
            },
            success: function (result) {
                console.log(result);
                alert(result);
                window.location.reload("first_version.html")
            },
            error: function (xhr) {
                alert(xhr)
            }

        });

      })
    }

  </script>

</body>
</html>